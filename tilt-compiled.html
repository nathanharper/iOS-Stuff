<html>
<head>
<style>
  * {
    margin: 0;
    padding: 0; 
    text-decoration: none; 
    -webkit-touch-callout:none; 
    -webkit-user-select:none; 
    -webkit-text-size-adjust:none; 
    -webkit-tap-highlight-color: transparent;
  }
  #code {
    margin: 4em;
    padding: 1em;
    border: 1px solid black;
  }
</style>
</head>
<body>
<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
// Generated by CoffeeScript 1.3.3
(function() {
  var aX, aY, aZ, blueSquare, filter, greenSquare, redSquare, sensitivity, square;
  var socket = io.connect();

  document.body.style.webkitTransformStyle = 'preserve-3d';

  document.body.style.webkitPerspective = 500;

  square = function(color) {
    var el;
    el = document.createElement('div');
    el.style.position = 'absolute';
    el.style.width = '100px';
    el.style.height = '100px';
    el.style.background = color;
    el.style.left = "" + ((document.body.scrollWidth - 100) / 2) + "px";
    el.style.top = "" + ((document.body.scrollHeight - 100) / 2) + "px";
    document.body.appendChild(el);
    return el;
  };

  redSquare = square('rgba(255, 0, 0, 0.5)');

  greenSquare = square('rgba(0, 255, 0, 0.5)');

  blueSquare = square('rgba(0, 0, 255, 0.5)');

  aX = 0;

  aY = 0;

  aZ = 0;

  filter = 0.5;

  sensitivity = 20;

socket.on('connect', function() {
  window.addEventListener('devicemotion', function(e) {
    var x, y, z;
    // this was originally written for iPad, so the assumed orientation 
    // is different. reverse x and y acceleration.
    aX = e.accelerationIncludingGravity.y * filter + aX * (1.0 - filter);
    aY = e.accelerationIncludingGravity.x * filter + aY * (1.0 - filter);
    aZ = e.accelerationIncludingGravity.z * filter + aZ * (1.0 - filter);
    x = sensitivity * aX;
    y = sensitivity * aY;
    z = sensitivity * aZ;
    
    socket.emit('accelerator', x + ' ' + y + ' ' + z);
    redSquare.style.webkitTransform = 'translate3d(' + y + 'px,' + x + 'px,' + (-200 + z) + 'px)';
    greenSquare.style.webkitTransform = 'translate3d(' + y + 'px,' + x + 'px,' + z + 'px)';
    return blueSquare.style.webkitTransform = 'translate3d(' + y + 'px,' + x + 'px,' + (200 + z) + 'px)';
  });
});

}).call(this);
</script>
</body>
</html>
